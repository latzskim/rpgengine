<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:fragment="sessionsList">

    <section class="sessions">
        <div class="container">
            <h2 class="sessions__title">Available Sessions</h2>

            <table class="sessions__table">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Owner</th>
                    <th>Players</th>
                    <th>Pending</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <!-- Iterate over the List<SessionListViewModel> -->
                <tr th:each="ses : ${sessions}">
                    <td th:text="${ses.title}"></td>
                    <td th:text="${ses.description}"></td>
                    <td>
                            <span th:classappend="${ses.status == 'SCHEDULED' ? 'status--open' :
                                                    ses.status == 'IN_PROGRESS' ? 'status--progress' :
                                                    ses.status == 'CANCELLED' ? 'status--cancelled' :
                                                    ses.status == 'FINISHED' ? 'status--finished' : 'status--unknown'}"
                                  th:text="${ses.status}"></span>
                    </td>
                    <td>
                        <div class="owner">
                            <img th:if="${ses.ownerAvatarUrl}"
                                 th:src="${ses.ownerAvatarUrl}"
                                 th:alt="${ses.displayName}"
                                 class="owner__avatar"/>
                            <span th:text="${ses.displayName}"></span>
                        </div>
                    </td>
                    <td th:text="${ses.approvedPlayers} + ' approved'"></td>
                    <td th:text="${ses.pendingInvites} + ' pending'"></td>
                    <td class="actions">
                        <!-- Example actions â€“ adapt to your security / state -->
                        <a th:href="@{'/sessions/' + ${ses.id} + '/join'}"
                           th:classappend="${ses.status} != 'OPEN' ? 'btn--disabled'"
                           class="btn btn--sm btn--secondary"
                           th:text="${ses.status} == 'OPEN' ? 'Join' : 'View'"></a>

<!--                        <a th:if="${#authorization.expression('hasRole(''ROLE_GM'') or principal?.id == ' + ses.ownerId)}"-->
<!--                           th:href="@{'/sessions/' + ${ses.id} + '/edit'}"-->
<!--                           class="btn btn&#45;&#45;sm btn&#45;&#45;primary">Edit</a>-->
                    </td>
                </tr>

                <!-- Empty state -->
                <tr th:if="${sessions == null or #lists.isEmpty(sessions)}">
                    <td colspan="7" class="empty">No sessions available yet.</td>
                </tr>
                </tbody>
            </table>

            <p class="sessions__create">
                <a th:href="@{/sessions/create}" class="btn btn--primary">Create New Session</a>
            </p>
        </div>
    </section>

</th:block>
</html>